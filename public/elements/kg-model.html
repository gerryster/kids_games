<polymer-element name="kg-model">
  <script>
    Polymer('kg-model', {
      MAX_GUESSES: 10,

      ready: function() {
        this.asyncMethod(function() {
          this.incorrectCount = 0;
          this.answer = "cat";
          // create a placeholder space character for every letter in the answer
          this.guess = new Array(this.answer.length + 1).join(" ");
          // use an object for the set behavior of the keys:
          this.incorrectLetters = {};
        });
      },

      guessLetter: function(letter) {
        letter = letter.toLocaleLowerCase();
        if(this.answer.indexOf(letter) >= 0) {
          this._updateGuess(letter);
        } else {
          this.incorrectCount++;
          this.incorrectLetters[letter] = true;
        }
        this.checkGameOver();
      },

      // update the guess with the found letter
      _updateGuess: function(letter) {
        // TODO: this is quite imperative: rewrite this to be functional
        var foundIdx = 0;
        var lastReplaceIdx = 0;
        while ((foundIdx = this.answer.substr(lastReplaceIdx).indexOf(letter)) >= 0) {
          this.guess = this.guess.replaceAt(lastReplaceIdx + foundIdx, letter);

          // advance past the last replace
          lastReplaceIdx = lastReplaceIdx + foundIdx + 1;
        }
      },

      checkGameOver: function() {
        if(this.answer === this.guess) {
          alert("You won!  Nice job!");
          this.resetGame();
        } else if(this.incorrectCount === this.MAX_GUESSES) {
          alert("Sorry, the man is dead.  Better luck next time.");
          this.resetGame();
        }
      },

      resetGame: function() {
        this.ready();
      }
    });

    // From http://stackoverflow.com/questions/1431094/how-do-i-replace-a-character-at-a-particular-index-in-javascript
    String.prototype.replaceAt = function(index, character) {
      return this.substr(0, index) + character + this.substr(index+character.length);
    }
  </script>
</polymer-element>
